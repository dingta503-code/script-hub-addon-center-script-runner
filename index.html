<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>เว็บแจกสคริปต์ & ตัวรัน</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Prompt',sans-serif;}
body{background:#0f0f18;color:#fff;}
header{padding:16px;background:#111;text-align:center;position:sticky;top:0;z-index:100;}
h1,h2{color:#ffc107;}
.container{padding:20px;max-width:1000px;margin:auto;}
input[type=text],input[type=password]{width:100%;padding:10px;margin:10px 0;border-radius:8px;border:none;background:#222;color:#fff;}
button{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;background:#ffc107;color:#000;margin-left:6px;transition:0.2s;}
button:hover{background:#e6b800;}
.authCard{background:rgba(20,25,35,0.95);border-radius:16px;padding:32px;width:100%;max-width:400px;box-shadow:0 15px 40px rgba(0,0,0,0.7);margin:auto;display:flex;flex-direction:column;gap:24px;}
.authForm{display:flex;flex-direction:column;gap:12px;}
.small{font-size:13px;color:#aaa;text-align:center;}
.form-toggle{display:flex;justify-content:center;gap:12px;margin-bottom:12px;}
.form-toggle button{background:transparent;border:none;color:#aaa;font-weight:600;cursor:pointer;padding:6px 12px;border-radius:8px;transition:0.3s;}
.form-toggle button.active{background:#ffc107;color:#000;}

/* Tabs for categories */
.tab-container{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;}
.tab{padding:8px 16px;background:#222;border-radius:12px;cursor:pointer;transition:0.3s;}
.tab.active{background:#ffc107;color:#000;}

/* Category items */
.item-container{display:flex;flex-wrap:wrap;gap:12px;}
.item{padding:12px;background:#222;border-radius:12px;flex:1 1 250px;min-width:200px;display:flex;flex-direction:column;gap:6px;}
.item img{width:100%;border-radius:8px;object-fit:cover;max-height:150px;}
.item b{color:#fff;}
.item p{color:#aaa;}
.item button{margin-top:4px;}

/* Admin Panel */
.admin-panel{background:rgba(30,30,40,0.95);padding:16px;margin-bottom:20px;border-radius:12px;}
.admin-panel h3{color:#ffc107;margin-bottom:8px;}
.admin-panel button{margin:4px 4px 4px 0;}
</style>
</head>
<body>

<div id="mainContent">

<!-- LOGIN / REGISTER -->
<div class="authCard" id="authCard">
<h2 id="authTitle">เข้าสู่ระบบ</h2>
<div class="form-toggle">
<button id="toggleLogin" class="active">ล็อกอิน</button>
<button id="toggleRegister">สมัครสมาชิก</button>
</div>

<div id="loginForm" class="authForm">
<input id="loginUser" type="text" placeholder="ชื่อผู้ใช้">
<input id="loginPass" type="password" placeholder="รหัสผ่าน">
<button id="btnLogin">เข้าสู่ระบบ</button>
<div class="small">หากยังไม่มีบัญชีให้กด "สมัครสมาชิก"</div>
</div>

<div id="registerForm" class="authForm" style="display:none">
<input id="regUser" type="text" placeholder="ตั้งชื่อผู้ใช้">
<input id="regPass" type="password" placeholder="ตั้งรหัสผ่าน">
<button id="btnRegister">สมัคร</button>
<div class="small">บัญชีเก็บในเครื่อง — ล้างเบราว์เซอร์หายหมด</div>
</div>
</div>

<!-- USER / ADMIN INTERFACE -->
<div id="userInterface" style="display:none;">
<header><h1>สคริปต์ & ตัวรัน</h1></header>
<div class="container">

<!-- Admin Panel -->
<div id="adminPanel" class="admin-panel" style="display:none;">
<h3>หลังบ้าน (Admin)</h3>
<button onclick="addCategory()">+ สร้างหมวดหมู่ใหม่</button>
<div id="categoryAdminList"></div>
</div>

<input type="text" id="searchInput" placeholder="ค้นหาชื่อสคริปต์/ตัวรัน...">

<!-- Tabs / หมวดหมู่แนวนอน -->
<div class="tab-container" id="tabContainer"></div>

<!-- Items -->
<div class="item-container" id="itemContainer"></div>

</div>
</div>
</div>

<script>
// CONFIG
const CONFIG = { STORAGE_KEY:"sr_site_v8_users", ADMIN_CREDENTIALS:{username:"admin", password:"A9f!x7Kp#2Lq"} };

// STATE
let state={currentUser:null,activeTab:null};

// HELPERS
const $=(s)=>document.querySelector(s);
function loadUsers(){
  const raw=localStorage.getItem(CONFIG.STORAGE_KEY);
  let users=raw?JSON.parse(raw):[];
  if(!users.find(u=>u.username===CONFIG.ADMIN_CREDENTIALS.username)){
    users.push({username:CONFIG.ADMIN_CREDENTIALS.username,password:CONFIG.ADMIN_CREDENTIALS.password,isAdmin:true});
    localStorage.setItem(CONFIG.STORAGE_KEY,JSON.stringify(users));
  }
  return users;
}
function saveUsers(users){localStorage.setItem(CONFIG.STORAGE_KEY,JSON.stringify(users));}

// TOGGLE FORM
$('#toggleLogin').onclick=()=>{$('#loginForm').style.display='flex';$('#registerForm').style.display='none';$('#toggleLogin').classList.add('active');$('#toggleRegister').classList.remove('active');}
$('#toggleRegister').onclick=()=>{$('#loginForm').style.display='none';$('#registerForm').style.display='flex';$('#toggleLogin').classList.remove('active');$('#toggleRegister').classList.add('active');}

// REGISTER
$('#btnRegister').onclick=()=>{
  const u=$('#regUser').value.trim(), p=$('#regPass').value;
  if(!u||!p){alert('กรอกชื่อและรหัสผ่าน');return;}
  const users=loadUsers();
  if(users.find(x=>x.username===u)){alert('มีชื่อผู้ใช้นี้แล้ว');return;}
  users.push({username:u,password:p,isAdmin:false});
  saveUsers(users);
  alert('สมัครเรียบร้อย ล็อกอินได้เลย');
  $('#regUser').value='';$('#regPass').value='';
  $('#toggleLogin').click();
}

// LOGIN
$('#btnLogin').onclick=()=>{
  const u=$('#loginUser').value.trim(), p=$('#loginPass').value;
  if(!u||!p){alert('กรอกชื่อและรหัสผ่าน');return;}
  const users=loadUsers();
  const user=users.find(x=>x.username===u && x.password===p);
  if(!user){alert('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');return;}
  state.currentUser={username:user.username,isAdmin:!!user.isAdmin};
  localStorage.setItem("currentUser",JSON.stringify(state.currentUser));
  $('#authCard').style.display='none';
  $('#userInterface').style.display='block';
  if(state.currentUser.isAdmin) $('#adminPanel').style.display='block';
  initInterface();
}

// CATEGORIES
let categories = JSON.parse(localStorage.getItem("categories")||`[
  {"name":"สคริปต์","items":[{"name":"Script A","description":"คำอธิบาย Script A","copyText":"ข้อความ Script A","image":"https://via.placeholder.com/300x150"}]},
  {"name":"ตัวรัน","items":[{"name":"Runner X","description":"คำอธิบาย Runner X","copyText":"ข้อความ Runner X","downloadLink":"https://example.com/runnerX.exe","image":"https://via.placeholder.com/300x150"}]},
  {"name":"ติดต่อ","items":[{"name":"Discord","description":"ติดต่อแอดมิน","link":"https://discord.gg/rtfpN9pT35","image":"https://via.placeholder.com/150"}]}
]`);
function saveCategories(){localStorage.setItem("categories",JSON.stringify(categories));}

// RENDER TABS
function renderTabs(){
  const tabContainer=$('#tabContainer');
  tabContainer.innerHTML='';
  categories.forEach((cat,ci)=>{
    const tab=document.createElement('div'); tab.className='tab';
    tab.textContent=cat.name;
    if(state.activeTab===null) state.activeTab=0;
    if(ci===state.activeTab) tab.classList.add('active');
    tab.onclick=()=>{state.activeTab=ci; renderTabs(); renderItems();};
    tabContainer.appendChild(tab);
  });
}

// RENDER ITEMS
function renderItems(){
  const container=$('#itemContainer');
  container.innerHTML='';
  const cat=categories[state.activeTab];
  if(!cat) return;
  cat.items.forEach((item,index)=>{
    const div=document.createElement('div'); div.className='item';
    if(item.image) div.innerHTML=`<img src="${item.image}">`;
    div.innerHTML+=`<b>${item.name}</b><p>${item.description}</p>`;
    if(item.copyText){
      const btn=document.createElement('button'); btn.textContent='คัดลอกข้อความ';
      btn.onclick=()=>{navigator.clipboard.writeText(item.copyText); alert("คัดลอกเรียบร้อย");};
      div.appendChild(btn);
    }
    if(item.downloadLink){
      const btn=document.createElement('button'); btn.textContent='ดาวน์โหลด'; btn.onclick=()=>{window.open(item.downloadLink,'_blank');};
      div.appendChild(btn);
    }
    if(item.link){  // ปุ่มติดต่อ
      const btn=document.createElement('button'); btn.textContent='ติดต่อ'; btn.onclick=()=>{window.open(item.link,'_blank');};
      div.appendChild(btn);
    }
    if(state.currentUser.isAdmin){
      const editBtn=document.createElement('button'); editBtn.textContent='แก้ไข'; editBtn.onclick=()=>editItem(state.activeTab,index);
      const delBtn=document.createElement('button'); delBtn.textContent='ลบ'; delBtn.onclick=()=>{if(confirm("ลบไอเทม?")){categories[state.activeTab].items.splice(index,1); saveCategories(); renderItems(); renderAdminPanel();}};
      div.appendChild(editBtn); div.appendChild(delBtn);
    }
    container.appendChild(div);
  });
}

// ADMIN PANEL
function renderAdminPanel(){
  const panel=$('#categoryAdminList');
  panel.innerHTML='';
  categories.forEach((cat,ci)=>{
    const div=document.createElement('div');
    div.innerHTML=`<b>${cat.name}</b> <button onclick="editCategory(${ci})">แก้ไข</button> <button onclick="deleteCategory(${ci})">ลบ</button> <button onclick="addItem(${ci})">+ ไอเทม</button>`;
    panel.appendChild(div);
  });
}

// ADMIN FUNCTIONS
function addCategory(){
  const name=prompt("ชื่อหมวดหมู่ใหม่:");
  if(!name) return;
  categories.push({name,items:[]});
  saveCategories(); renderTabs(); renderAdminPanel();
}
function editCategory(index){
  const name=prompt("แก้ไขชื่อหมวดหมู่:", categories[index].name);
  if(!name) return;
  categories[index].name=name;
  saveCategories(); renderTabs(); renderAdminPanel();
}
function deleteCategory(index){
  if(confirm("ลบหมวดหมู่นี้?")){categories.splice(index,1); saveCategories(); renderTabs(); renderAdminPanel();}
}

// ADD ITEM
function addItem(catIndex){
  const name = prompt("ชื่อไอเทม:"); if(!name) return;
  const desc = prompt("คำอธิบาย:") || "";
  const copyText = prompt("ข้อความคัดลอก:") || name + "\n" + desc;

  const fileInput=document.createElement('input'); fileInput.type='file'; fileInput.accept='image/*';
  fileInput.onchange=e=>{
    const file=e.target.files[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=function(evt){
      let image=evt.target.result;
      let downloadLink = null; let link = null;
      if(categories[catIndex].name==="ตัวรัน") downloadLink=prompt("ลิงก์ดาวน์โหลด:")||null;
      if(categories[catIndex].name==="ติดต่อ") link=prompt("ลิงก์ติดต่อ:", "https://discord.gg/rtfpN9pT35")||null;
      categories[catIndex].items.push({name,description:desc,copyText,downloadLink,link,image});
      saveCategories(); renderItems(); renderAdminPanel();
    }
    reader.readAsDataURL(file);
  }
  fileInput.click();
}

// EDIT ITEM
function editItem(catIndex,index){
  const item=categories[catIndex].items[index];
  const name=prompt("ชื่อ:",item.name); if(!name) return;
  const desc=prompt("คำอธิบาย:",item.description)||"";
  let copyText = item.copyText || "";
  if(confirm("แก้ไขข้อความคัดลอก?")) copyText = prompt("ข้อความคัดลอก:",copyText)||"";
  let downloadLink=item.downloadLink||null; if(confirm("แก้ไขลิงก์ดาวน์โหลด?")) downloadLink=prompt("ลิงก์ดาวน์โหลด:",downloadLink)||null;
  let link=item.link||null; if(confirm("แก้ไขลิงก์ติดต่อ?")) link=prompt("ลิงก์ติดต่อ:",link)||null;
  item.name=name; item.description=desc; item.copyText=copyText; item.downloadLink=downloadLink; item.link=link;
  saveCategories(); renderItems(); renderAdminPanel();
}

// SEARCH
$('#searchInput').addEventListener('input', e=>{
  const query=e.target.value.toLowerCase();
  const filtered=categories.map(cat=>{return {name:cat.name,items:cat.items.filter(i=>i.name.toLowerCase().includes(query))};});
  renderFiltered(filtered);
});
function renderFiltered(filtered){
  const container=$('#itemContainer'); container.innerHTML='';
  filtered.forEach(cat=>{cat.items.forEach((item,index)=>{
    const div=document.createElement('div'); div.className='item';
    if(item.image) div.innerHTML=`<img src="${item.image}">`;
    div.innerHTML+=`<b>${item.name}</b><p>${item.description}</p>`;
    if(item.copyText){const btn=document.createElement('button'); btn.textContent='คัดลอกข้อความ'; btn.onclick=()=>{navigator.clipboard.writeText(item.copyText); alert("คัดลอกเรียบร้อย");}; div.appendChild(btn);}
    if(item.downloadLink){const btn=document.createElement('button'); btn.textContent='ดาวน์โหลด'; btn.onclick=()=>{window.open(item.downloadLink,'_blank');}; div.appendChild(btn);}
    if(item.link){const btn=document.createElement('button'); btn.textContent='ติดต่อ'; btn.onclick=()=>{window.open(item.link,'_blank');}; div.appendChild(btn);}
    container.appendChild(div);
  });});
}

// INIT
function initInterface(){renderTabs(); renderItems(); renderAdminPanel();}
</script>
</body>
</html>
