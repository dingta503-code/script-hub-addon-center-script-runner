<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>เว็บแจกสคริปต์ & ตัวรัน — เข้าสู่ระบบ</title>
  <meta name="description" content="เว็บแจกสคริปต์และตัวรัน — ต้องสมัคร/ล็อกอิน ก่อนใช้งาน" />
  <style>
    /* ธีม ดำ-ขาว เรียบเท่ */
    :root{
      --bg:#0b0b0b; --card:#0f1720; --muted:#9aa4ad; --accent:#ffffff;
      --glass: rgba(255,255,255,0.04);
      --radius:12px; --danger:#ff6b6b;
      font-family: Inter, "Prompt", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#050505,#0a0a0a);color:#e9eef2;
      -webkit-font-smoothing:antialiased;padding:0;
    }
    /* full screen auth */
    #authWrap{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:
      linear-gradient(180deg, rgba(2,6,10,0.8), rgba(2,6,10,0.9));
      z-index:9999;padding:20px;
    }
    .authCard{width:100%;max-width:920px;background:#071018;border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(0,0,0,0.6);display:grid;grid-template-columns:1fr 400px;gap:18px}
    @media(max-width:900px){ .authCard{grid-template-columns:1fr; padding:14px} }
    .authLeft{padding:8px}
    .logo{height:56px;width:56px;border-radius:12px;background:#fff;color:#020617;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px}
    h2{margin:0 0 6px 0}
    p.muted{color:var(--muted);margin:0 0 12px 0}
    .authForm{display:grid;gap:10px}
    input[type=text], input[type=password]{
      padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px;
    }
    button{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#05060a;font-weight:700;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    .or{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px}
    .or:before,.or:after{content:"";height:1px;background:rgba(255,255,255,0.03);flex:1}
    .authRight{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:10px}
    .hint{font-size:13px;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .container{max-width:1100px;margin:28px auto;padding:0 18px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .titleSite{font-weight:700}
    .subtitle{color:var(--muted);font-size:13px}
    .tabs{margin-top:18px;display:flex;gap:8px}
    .tab{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted)}
    .tab.active{background:#fff;color:#03060a;font-weight:700}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:18px}
    @media(max-width:880px){ .grid{grid-template-columns:1fr} }
    .card{background:#071018;border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:12px;align-items:flex-start}
    .thumb{width:120px;height:80px;border-radius:8px;background:#061218;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;overflow:hidden}
    .content{flex:1}
    .title{font-weight:700;margin:0 0 6px 0}
    .desc{color:var(--muted);font-size:13px;margin-bottom:8px}
    .actions{display:flex;gap:8px;margin-top:8px}
    .copy-box{background:#061219;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-family:monospace;font-size:13px;color:#dff6f0;white-space:pre-wrap;max-height:200px;overflow:auto}
    footer{margin-top:18px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted)}
    .danger{background:var(--danger);color:#200;border-radius:10px;padding:8px 10px;border:none}
    .small-btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--accent)}
    .contact-btn{display:inline-block;padding:10px 12px;border-radius:10px;background:#ffffff;color:#000;text-decoration:none;font-weight:700}
    /* tiny helpers */
    .hide{display:none}
  </style>
</head>
<body>
  <!-- AUTH FULLSCREEN: หน้าเต็มก่อนเข้าเว็บ -->
  <div id="authWrap">
    <div class="authCard" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="authLeft">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="logo">S</div>
          <div>
            <h2 id="authTitle">เข้าสู่ระบบ / สมัครสมาชิก</h2>
            <p class="muted">ต้องสมัครก่อนใช้งานเว็บ — เก็บข้อมูลในเครื่อง (localStorage)</p>
          </div>
        </div>

        <div style="margin-top:12px" id="authMessages" class="hint"></div>

        <!-- LOGIN FORM -->
        <div id="loginForm" class="authForm">
          <input id="loginUser" type="text" placeholder="ชื่อผู้ใช้" />
          <input id="loginPass" type="password" placeholder="รหัสผ่าน" />
          <div style="display:flex;gap:8px">
            <button id="btnLogin">ล็อกอิน</button>
            <button id="btnShowRegister" class="btn-ghost">สมัครสมาชิก</button>
          </div>
          <div style="margin-top:6px" class="small muted">หากยังไม่มีบัญชีให้กด "สมัครสมาชิก"</div>
        </div>

        <!-- REGISTER FORM -->
        <div id="registerForm" class="authForm hide">
          <input id="regUser" type="text" placeholder="ตั้งชื่อผู้ใช้ (จะจำไว้ในเครื่อง)" />
          <input id="regPass" type="password" placeholder="ตั้งรหัสผ่าน" />
          <div style="display:flex;gap:8px">
            <button id="btnRegister">สมัคร</button>
            <button id="btnShowLogin" class="btn-ghost">กลับไปล็อกอิน</button>
          </div>
          <div class="muted small">บัญชีจะเก็บในเครื่องเท่านั้น — ถาล้างข้อมูลเบราว์เซอร์จะสูญหาย</div>
        </div>

        <div style="margin-top:12px" class="or"><span>หรือ</span></div>

        <div style="margin-top:12px" class="small muted">
          <div><strong>บัญชีแอดมินเริ่มต้น (เปลี่ยนได้ในหลังบ้าน)</strong></div>
          <div id="adminInfo" style="margin-top:6px"></div>
        </div>
      </div>

      <div class="authRight">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small muted">เว็บแจกสคริปต์ & ตัวรัน</div>
            <div style="font-weight:700;font-size:18px">ระบบต้องสมัครก่อนเข้า — ธีม ดำ-ขาว</div>
          </div>
          <div class="small muted">เวอร์ชัน: 1.0</div>
        </div>

        <div style="margin-top:8px">
          <div style="font-weight:700">ข้อควรรู้</div>
          <ul style="margin:8px 0 0 18px;color:var(--muted);padding:0">
            <li>ข้อมูลบัญชีเก็บในเครื่อง (localStorage)</li>
            <li>บัญชีแอดมินล่วงหน้าอยู่ด้านล่าง — ล็อกอินเพื่อเข้าหลังบ้าน</li>
            <li>สามารถ Export / Import ข้อมูลได้จากหน้าเว็บ</li>
          </ul>
        </div>

        <div style="margin-top:auto">
          <div style="font-size:13px;color:var(--muted)">ต้องการเปลี่ยนค่าเริ่มต้น (Discord, admin) แก้ในตัวไฟล์ index.html ตรง CONFIG</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN SITE (ซ่อนจนกว่าจะล็อกอิน) -->
  <div id="app" class="container" style="display:none">
    <header>
      <div class="brand">
        <div class="logo" style="width:44px;height:44px;border-radius:10px;background:#fff;color:#000">S</div>
        <div>
          <div class="titleSite">เว็บแจกสคริปต์ & ตัวรัน</div>
          <div class="subtitle">แยกหมวด: สคริปต์ / ตัวรัน / ติดต่อแอดมิน</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div id="loggedAs" class="muted small"></div>
        <button id="btnOpenAdminPanel" class="small-btn hide">หลังบ้าน</button>
        <button id="btnLogout" class="small-btn">ออกจากระบบ</button>
      </div>
    </header>

    <div class="tabs" role="tablist" style="margin-top:18px">
      <div class="tab active" data-tab="scripts">สคริปต์</div>
      <div class="tab" data-tab="runners">ตัวรัน</div>
      <div class="tab" data-tab="contact">ติดต่อแอดมิน</div>
    </div>

    <main id="mainContent">
      <div id="list" class="grid"></div>
      <div id="empty" class="card" style="display:none">ไม่มีรายการในหมวดนี้</div>
    </main>

    <footer>
      <div class="muted">จัดเก็บข้อมูลในเครื่อง (localStorage). ใช้ Export/Import เพื่อย้ายข้อมูล</div>
      <div style="display:flex;gap:8px">
        <button id="exportBtn" class="small-btn">Export JSON</button>
        <button id="importBtn" class="small-btn">Import JSON</button>
        <button id="clearAll" class="danger">ลบทั้งหมด</button>
      </div>
    </footer>
  </div>

<script>
/*
  Single-file site with:
  - Full-page auth (register/login) saved to localStorage
  - Pre-created admin account (hard password) — change in CONFIG
  - Scripts / Runners management (admin-only add/edit/delete)
  - Contact tab with Discord link
  - All data stored under STORAGE_KEY in localStorage

  IMPORTANT: If you want to change Discord invite or admin credentials, edit CONFIG below.
*/

/* ---------------- CONFIG ---------------- */
const CONFIG = {
  DISCORD_LINK: "https://discord.gg/your-invite", // <-- เปลี่ยนเป็นลิงก์ดิสคอร์ดจริงของมึง
  STORAGE_KEY: "sr_site_v2_data",
  USERS_KEY: "sr_site_v2_users",
  ADMIN_CREDENTIALS: { username: "admin", password: "A9f!x7Kp#2Lq" } // รหัสแอดมินยาก ๆ ที่ตั้งให้ (เปลี่ยนได้)
};
/* ----------------------------------------- */

/* -- ประกาศตัวแปรสถานะ -- */
let state = {
  currentUser: null, // { username, isAdmin }
  data: { scripts: [], runners: [] }
};

/* -- helpers -- */
const $ = (q, ctx=document) => ctx.querySelector(q);
const $$ = (q, ctx=document) => Array.from(ctx.querySelectorAll(q));
const uid = () => 'id_' + Math.random().toString(36).slice(2,10);

function saveData(){ localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(state.data)); }
function loadData(){
  const raw = localStorage.getItem(CONFIG.STORAGE_KEY);
  if(!raw){
    // seed sample
    state.data = {
      scripts: [
        { id: uid(), name: "Script ตัวอย่าง", desc: "ฟังก์ชันตัวอย่าง", img: "", code: "// ตัวอย่างโค้ด\\nconsole.log('hi')" }
      ],
      runners: [
        { id: uid(), name: "Runner ตัวอย่าง", desc: "ดาวน์โหลดตัวอย่าง", img: "", filename: "runner.txt", filecontent: "นี่คือไฟล์ตัวรันตัวอย่าง" }
      ]
    };
    saveData();
  } else {
    try{ state.data = JSON.parse(raw); if(!state.data.scripts) state.data.scripts=[]; if(!state.data.runners) state.data.runners=[]; }
    catch(e){ state.data = { scripts: [], runners: [] }; saveData(); }
  }
}

/* ---------------- Users ---------------- */
function loadUsers(){
  const raw = localStorage.getItem(CONFIG.USERS_KEY);
  let users = [];
  if(raw){
    try{ users = JSON.parse(raw); }
    catch(e){ users = []; }
  }
  // ensure admin exists
  const admin = users.find(u=>u.username === CONFIG.ADMIN_CREDENTIALS.username);
  if(!admin){
    users.push({ username: CONFIG.ADMIN_CREDENTIALS.username, password: CONFIG.ADMIN_CREDENTIALS.password, isAdmin: true });
    localStorage.setItem(CONFIG.USERS_KEY, JSON.stringify(users));
  }
  return users;
}
function saveUsers(users){ localStorage.setItem(CONFIG.USERS_KEY, JSON.stringify(users)); }

/* ------------- UI / Render -------------- */
function updateAdminInfoBox(){
  const el = $('#adminInfo');
  if(!el) return;
  el.innerHTML = `<div style="background:rgba(255,255,255,0.03);padding:8px;border-radius:8px">
    <div>ชื่อผู้ใช้: <strong>${CONFIG.ADMIN_CREDENTIALS.username}</strong></div>
    <div>รหัสผ่านเริ่มต้น: <strong style="letter-spacing:1px">${CONFIG.ADMIN_CREDENTIALS.password}</strong></div>
    <div class="muted small" style="margin-top:6px">ล็อกอินด้วยบัญชีนี้เพื่อเข้าหลังบ้าน — แนะนำเปลี่ยนพาสในหลังบ้าน</div>
  </div>`;
}

/* show main app after login */
function showApp(){
  $('#authWrap').style.display = 'none';
  $('#app').style.display = 'block';
  $('#loggedAs').textContent = `เข้าสู่ระบบ: ${state.currentUser.username}${state.currentUser.isAdmin ? " (Admin)" : ""}`;
  if(state.currentUser.isAdmin) $('#btnOpenAdminPanel').classList.remove('hide');
  else $('#btnOpenAdminPanel').classList.add('hide');

  render();
}

/* render lists */
function render(){
  // tabs
  $$('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === (state.viewTab || 'scripts')));

  const list = $('#list');
  list.innerHTML = '';
  const tab = state.viewTab || 'scripts';

  if(tab === 'contact'){
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div style="flex:1">
        <div class="title">ติดต่อแอดมิน</div>
        <div class="desc">หากต้องการความช่วยเหลือหรือแจ้งปัญหา กดปุ่มเข้าดิสคอร์ดได้เลย</div>
        <div style="margin-top:12px"><a class="contact-btn" href="${CONFIG.DISCORD_LINK}" target="_blank" rel="noopener">เข้าดิสคอร์ด</a></div>
      </div>
    `;
    list.appendChild(card);
    return;
  }

  const items = tab === 'scripts' ? state.data.scripts : state.data.runners;
  if(items.length === 0){
    $('#empty').style.display = 'block'; $('#list').style.display = 'none'; return;
  } else { $('#empty').style.display='none'; $('#list').style.display='grid'; }

  items.forEach(item=>{
    const card = document.createElement('div'); card.className='card';
    const thumb = document.createElement('div'); thumb.className='thumb';
    if(item.img){ const img = document.createElement('img'); img.src = item.img; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; thumb.appendChild(img); }
    else thumb.innerHTML = '<div style="padding:8px;color:var(--muted);text-align:center">ไม่มีรูปตัวอย่าง</div>';
    const content = document.createElement('div'); content.className='content';
    content.innerHTML = `<div class="title">${item.name}</div><div class="desc">${item.desc||''}</div>`;
    const actions = document.createElement('div'); actions.className='actions';

    if(tab === 'scripts'){
      const codeBox = document.createElement('pre'); codeBox.className='copy-box'; codeBox.textContent = item.code || '';
      const copyBtn = document.createElement('button'); copyBtn.textContent='คัดลอกโค้ด';
      copyBtn.onclick = async ()=> {
        try{ await navigator.clipboard.writeText(item.code || ''); copyBtn.textContent='คัดลอกแล้ว ✓'; setTimeout(()=>copyBtn.textContent='คัดลอกโค้ด',1200); }
        catch(e){ alert('คัดลอกไม่สำเร็จ'); }
      };
      actions.appendChild(copyBtn);
      if(state.currentUser.isAdmin){
        const edit = document.createElement('button'); edit.textContent='แก้ไข'; edit.className='btn-ghost';
        edit.onclick = ()=> openEditModal('scripts', item.id);
        const del = document.createElement('button'); del.textContent='ลบ'; del.className='danger';
        del.onclick = ()=> { if(confirm('ลบรายการ?')){ state.data.scripts = state.data.scripts.filter(s=>s.id!==item.id); saveData(); render(); } };
        actions.appendChild(edit); actions.appendChild(del);
      }
      content.appendChild(codeBox);
      content.appendChild(actions);
    } else {
      const dl = document.createElement('button'); dl.textContent='ดาวน์โหลด';
      dl.onclick = ()=> downloadRunner(item);
      actions.appendChild(dl);
      const info = document.createElement('button'); info.textContent='รายละเอียด'; info.className='btn-ghost';
      info.onclick = ()=> alert(`${item.name}\n\n${item.desc||''}`);
      actions.appendChild(info);
      if(state.currentUser.isAdmin){
        const edit = document.createElement('button'); edit.textContent='แก้ไข'; edit.className='btn-ghost';
        edit.onclick = ()=> openEditModal('runners', item.id);
        const del = document.createElement('button'); del.textContent='ลบ'; del.className='danger';
        del.onclick = ()=> { if(confirm('ลบรายการ?')){ state.data.runners = state.data.runners.filter(r=>r.id!==item.id); saveData(); render(); } };
        actions.appendChild(edit); actions.appendChild(del);
      }
      content.appendChild(actions);
    }

    card.appendChild(thumb); card.appendChild(content); list.appendChild(card);
  });
}

/* download runner */
function downloadRunner(item){
  const filename = item.filename || (item.name.replace(/\s+/g,'_') + '.txt');
  const blob = new Blob([item.filecontent || ''], { type: 'application/octet-stream' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(url), 2000);
}

/* -------------- Admin Panel -------------- */
function openAdminPanel(){
  if(!state.currentUser || !state.currentUser.isAdmin){ alert('ต้องเป็นแอดมินเท่านั้น'); return; }
  // simple modal using prompt-based UI (single-file)
  const action = prompt('Admin Panel — พิมพ์คำสั่ง:\n1 = เพิ่ม Script\n2 = เพิ่ม Runner\n3 = เปลี่ยนรหัสแอดมิน\n4 = ดูรายการทั้งหมด\n(ยกเลิกเพื่อออก)');
  if(!action) return;
  if(action==='1'){ openEditModal('scripts'); }
  else if(action==='2'){ openEditModal('runners'); }
  else if(action==='3'){
    const newPw = prompt('ตั้งรหัสแอดมินใหม่: (username เดิม: ' + CONFIG.ADMIN_CREDENTIALS.username + ')');
    if(newPw){
      // update users list
      const users = loadUsers();
      const admin = users.find(u=>u.username===CONFIG.ADMIN_CREDENTIALS.username);
      if(admin){ admin.password = newPw; saveUsers(users); alert('เปลี่ยนรหัสแอดมินเรียบร้อย'); }
      else { users.push({ username: CONFIG.ADMIN_CREDENTIALS.username, password:newPw, isAdmin:true }); saveUsers(users); alert('สร้าง/อัปเดตแอดมินเรียบร้อย'); }
    }
  }
  else if(action==='4'){
    const list = state.data.scripts.map(s=>`[Script] ${s.name}`).concat(state.data.runners.map(r=>`[Runner] ${r.name}`)).join('\n');
    alert('รายการทั้งหมด:\n\n' + (list || 'ยังไม่มีรายการ'));
  } else alert('คำสั่งไม่รู้จัก');
}

/* -------------- Edit Modal (simple prompts) -------------- */
function openEditModal(type, id){
  if(!state.currentUser || !state.currentUser.isAdmin){ alert('ต้องเป็นแอดมิน'); return; }
  if(type==='scripts'){
    if(id){
      const it = state.data.scripts.find(s=>s.id===id); if(!it) return;
      const name = prompt('ชื่อ', it.name); if(!name) return;
      const desc = prompt('คำอธิบาย', it.desc||'')||'';
      const img = prompt('URL รูป (ปล่อยว่างก็ได้)', it.img||'')||'';
      const code = prompt('โค้ด (จะเก็บเป็นข้อความ)', it.code||'')||'';
      it.name=name; it.desc=desc; it.img=img; it.code=code; saveData(); render();
    } else {
      const name = prompt('ชื่อ Script'); if(!name) return;
      const desc = prompt('คำอธิบาย')||'';
      const img = prompt('URL รูป (ปล่อยว่างก็ได้)')||'';
      const code = prompt('โค้ด (จะเก็บเป็นข้อความ)')||'';
      state.data.scripts.push({ id: uid(), name, desc, img, code }); saveData(); render();
    }
  } else {
    if(id){
      const it = state.data.runners.find(r=>r.id===id); if(!it) return;
      const name = prompt('ชื่อ', it.name); if(!name) return;
      const desc = prompt('คำอธิบาย', it.desc||'')||'';
      const img = prompt('URL รูป (ปล่อยว่างก็ได้)', it.img||'')||'';
      const filename = prompt('ชื่อไฟล์ดาวน์โหลด', it.filename||'runner.txt')||'runner.txt';
      const content = prompt('เนื้อหาไฟล์ (text)', it.filecontent||'')||'';
      it.name=name; it.desc=desc; it.img=img; it.filename=filename; it.filecontent=content; saveData(); render();
    } else {
      const name = prompt('ชื่อ Runner'); if(!name) return;
      const desc = prompt('คำอธิบาย')||'';
      const img = prompt('URL รูป (ปล่อยว่างก็ได้)')||'';
      const filename = prompt('ชื่อไฟล์ดาวน์โหลด (เช่น runner.zip)')||'runner.txt';
      const content = prompt('เนื้อหาไฟล์ (text)')||'';
      state.data.runners.push({ id: uid(), name, desc, img, filename, filecontent: content }); saveData(); render();
    }
  }
}

/* -------------- Auth actions -------------- */
function showLogin(){ $('#loginForm').classList.remove('hide'); $('#registerForm').classList.add('hide'); $('#authMessages').textContent=''; }
function showRegister(){ $('#loginForm').classList.add('hide'); $('#registerForm').classList.remove('hide'); $('#authMessages').textContent=''; }

$('#btnShowRegister').onclick = showRegister;
$('#btnShowLogin').onclick = showLogin;

$('#btnRegister').onclick = ()=>{
  const u = $('#regUser').value.trim();
  const p = $('#regPass').value;
  if(!u || !p){ alert('กรอกชื่อผู้ใช้และรหัสผ่าน'); return; }
  const users = loadUsers();
  if(users.find(x=>x.username === u)){ alert('มีชื่อผู้ใช้นี้แล้ว'); return; }
  users.push({ username: u, password: p, isAdmin:false });
  saveUsers(users);
  alert('สมัครเรียบร้อย ล็อกอินได้เลย');
  showLogin();
  $('#regUser').value=''; $('#regPass').value='';
};

$('#btnLogin').onclick = ()=>{
  const u = $('#loginUser').value.trim();
  const p = $('#loginPass').value;
  if(!u || !p){ alert('กรอกชื่อผู้ใช้และรหัสผ่าน'); return; }
  const users = loadUsers();
  const user = users.find(x=>x.username === u && x.password === p);
  if(!user){ alert('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง'); return; }
  state.currentUser = { username: user.username, isAdmin: !!user.isAdmin };
  // hide auth, show app
  $('#loginUser').value=''; $('#loginPass').value='';
  showApp();
};

/* logout */
$('#btnLogout').onclick = ()=>{
  if(confirm('ออกจากระบบ?')){ state.currentUser = null; $('#app').style.display='none'; $('#authWrap').style.display='flex'; }
};

/* tabs */
$$('.tab').forEach(t => t.addEventListener('click', ()=>{
  state.viewTab = t.dataset.tab;
  render();
}));

/* admin open panel */
$('#btnOpenAdminPanel').onclick = openAdminPanel;

/* export / import / clear */
$('#exportBtn').onclick = ()=>{
  const dataStr = JSON.stringify({ data: state.data, users: loadUsers() }, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'sr_backup.json'; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(a.href),2000);
};
$('#importBtn').onclick = ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = e=>{
    const f = e.target.files[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = evt=>{
      try{
        const parsed = JSON.parse(evt.target.result);
        if(parsed.data){
          if(confirm('นำเข้าแล้วจะเขียนทับข้อมูลเดิม ใช่หรือไม่?')){ state.data = parsed.data; saveData(); if(parsed.users) saveUsers(parsed.users); render(); alert('นำเข้าเรียบร้อย'); }
        } else alert('ไฟล์ไม่ถูกต้อง');
      }catch(err){ alert('อ่านไฟล์ไม่สำเร็จ'); }
    };
    r.readAsText(f);
  };
  input.click();
};
$('#clearAll').onclick = ()=>{
  if(!confirm('ลบข้อมูลทั้งหมดในเครื่อง (localStorage) จริงไหม?')) return;
  localStorage.removeItem(CONFIG.STORAGE_KEY);
  localStorage.removeItem(CONFIG.USERS_KEY);
  loadData(); render(); alert('ลบเรียบร้อย — รีเฟรชหน้าเพื่อเริ่มใหม่');
};

/* init */
updateAdminInfoBox();
loadData();
render();
// show admin info (soเจ้าของรู้พาส)
$('#adminInfo').style.display = 'block';

/* If user already has logged-in session saved? We keep it transient (no persistent session) */
/* If you want "จำฉันไว้" ให้เพิ่ม logic เก็บ currentUser ลง localStorage */

</script>
</body>
</html>
