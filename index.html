<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>เว็บแจกสคริปต์ & ตัวรัน</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Prompt',sans-serif;}
body{background:#0a0a0f;color:#fff;}
button{cursor:pointer;}
.container{padding:20px;}
h1{color:#ffcc00;margin-bottom:20px;}
nav{margin-bottom:20px;}
nav button{margin-right:10px;padding:8px 16px;border:none;border-radius:8px;background:#ffcc00;color:#000;font-weight:600;}
nav button.active{background:#e6b800;}
.card{background:rgba(20,25,35,0.9);padding:12px;margin-bottom:10px;border-radius:10px;}
input,textarea{padding:8px;border-radius:8px;border:none;width:100%;margin-bottom:6px;background:rgba(255,255,255,0.05);color:#fff;}
.adminControls{margin-top:6px;}
.adminControls button{margin-right:6px;background:#ff4d4d;color:#fff;border:none;padding:4px 8px;border-radius:6px;}
</style>
</head>
<body>

<div class="container" id="loginPage">
  <h1>เข้าสู่ระบบ / สมัครสมาชิก</h1>
  <input type="text" id="username" placeholder="ชื่อผู้ใช้">
  <input type="password" id="password" placeholder="รหัสผ่าน">
  <button id="btnLogin">เข้าสู่ระบบ</button>
  <button id="btnRegister">สมัครสมาชิก</button>
  <p>Admin: admin / A9f!x7Kp#2Lq</p>
</div>

<div class="container" id="mainPage" style="display:none">
  <h1>เว็บแจกสคริปต์ & ตัวรัน</h1>
  <nav>
    <button class="tabBtn active" data-tab="scriptTab">สคริปต์</button>
    <button class="tabBtn" data-tab="runnerTab">ตัวรัน</button>
    <button class="tabBtn" data-tab="contactTab">ติดต่อแอดมิน</button>
    <button id="btnLogout" style="float:right;background:#ff4d4d;color:#fff;">ออกจากระบบ</button>
  </nav>

  <!-- สคริปต์ -->
  <div id="scriptTab" class="tabContent"></div>

  <!-- ตัวรัน -->
  <div id="runnerTab" class="tabContent" style="display:none"></div>

  <!-- ติดต่อ -->
  <div id="contactTab" class="tabContent" style="display:none">
    <p>ติดต่อแอดมินผ่าน Discord: <a href="https://discord.gg/" target="_blank">คลิกที่นี่</a></p>
  </div>
</div>

<script>
const CONFIG={
  STORAGE_KEY_USERS:"sr_users",
  STORAGE_KEY_ITEMS:"sr_items",
  ADMIN_CREDENTIALS:{username:"admin",password:"A9f!x7Kp#2Lq"}
};

// --- HELPERS ---
const $=(s)=>document.querySelector(s);
const $$=(s)=>document.querySelectorAll(s);

// --- LOAD / SAVE USERS ---
function loadUsers(){
  let raw=localStorage.getItem(CONFIG.STORAGE_KEY_USERS);
  let users = raw?JSON.parse(raw):[];
  if(!users.find(u=>u.username===CONFIG.ADMIN_CREDENTIALS.username)){
    users.push({username:CONFIG.ADMIN_CREDENTIALS.username,password:CONFIG.ADMIN_CREDENTIALS.password,isAdmin:true});
    localStorage.setItem(CONFIG.STORAGE_KEY_USERS,JSON.stringify(users));
  }
  return users;
}
function saveUsers(users){ localStorage.setItem(CONFIG.STORAGE_KEY_USERS,JSON.stringify(users)); }

// --- LOAD / SAVE ITEMS (script/runner) ---
function loadItems(){
  let raw=localStorage.getItem(CONFIG.STORAGE_KEY_ITEMS);
  return raw?JSON.parse(raw):{scripts:[],runners:[]};
}
function saveItems(items){ localStorage.setItem(CONFIG.STORAGE_KEY_ITEMS,JSON.stringify(items)); }

// --- STATE ---
let state={currentUser:null};

// --- LOGIN ---
$('#btnLogin').onclick=()=>{
  const u=$('#username').value.trim(), p=$('#password').value;
  if(!u||!p){ alert('กรอกชื่อและรหัสผ่าน'); return; }
  const users=loadUsers();
  const user=users.find(x=>x.username===u && x.password===p);
  if(!user){ alert('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง'); return; }
  state.currentUser={username:user.username,isAdmin:!!user.isAdmin};
  $('#loginPage').style.display='none';
  $('#mainPage').style.display='block';
  $('#username').value='';$('#password').value='';
  renderItems();
}

// --- REGISTER ---
$('#btnRegister').onclick=()=>{
  const u=$('#username').value.trim(), p=$('#password').value;
  if(!u||!p){ alert('กรอกชื่อและรหัสผ่าน'); return; }
  const users=loadUsers();
  if(users.find(x=>x.username===u)){ alert('มีชื่อผู้ใช้นี้แล้ว'); return; }
  users.push({username:u,password:p,isAdmin:false});
  saveUsers(users);
  alert('สมัครเรียบร้อย ล็อกอินได้เลย');
}

// --- LOGOUT ---
$('#btnLogout').onclick=()=>{
  state.currentUser=null;
  $('#mainPage').style.display='none';
  $('#loginPage').style.display='block';
}

// --- TAB SWITCH ---
$$('.tabBtn').forEach(btn=>{
  btn.onclick=()=>{
    $$('.tabBtn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    $$('.tabContent').forEach(c=>c.style.display='none');
    $(btn.dataset.tab).style.display='block';
  }
});

// --- RENDER ITEMS ---
function renderItems(){
  const items=loadItems();
  const scriptTab=$('#scriptTab');
  const runnerTab=$('#runnerTab');
  scriptTab.innerHTML=''; runnerTab.innerHTML='';

  items.scripts.forEach((item,i)=>{
    const div=document.createElement('div'); div.className='card';
    div.innerHTML=`<strong>${item.name}</strong> <a href="${item.link}" target="_blank">ดาวน์โหลด</a>`;
    if(state.currentUser.isAdmin){
      const ctrl=document.createElement('div'); ctrl.className='adminControls';
      ctrl.innerHTML=`<button onclick="deleteItem('scripts',${i})">ลบ</button>`;
      div.appendChild(ctrl);
    }
    scriptTab.appendChild(div);
  });

  items.runners.forEach((item,i)=>{
    const div=document.createElement('div'); div.className='card';
    div.innerHTML=`<strong>${item.name}</strong> <a href="${item.link}" target="_blank">ดาวน์โหลด</a>`;
    if(state.currentUser.isAdmin){
      const ctrl=document.createElement('div'); ctrl.className='adminControls';
      ctrl.innerHTML=`<button onclick="deleteItem('runners',${i})">ลบ</button>`;
      div.appendChild(ctrl);
    }
    runnerTab.appendChild(div);
  });

  if(state.currentUser.isAdmin){
    addAdminAddButtons();
  }
}

// --- ADMIN ADD ---
function addAdminAddButtons(){
  const items=loadItems();
  ['scriptTab','runnerTab'].forEach(tabId=>{
    const tab=$(`#${tabId}`);
    const btn=document.createElement('button'); 
    btn.textContent='เพิ่มรายการ';
    btn.style.marginTop='10px';
    btn.onclick=()=>{
      const name=prompt('ชื่อรายการ?'); if(!name) return;
      const link=prompt('ลิงค์ดาวน์โหลด?'); if(!link) return;
      if(tabId==='scriptTab') items.scripts.push({name,link});
      else items.runners.push({name,link});
      saveItems(items); renderItems();
    }
    tab.appendChild(btn);
  });
}

// --- ADMIN DELETE ---
function deleteItem(type,index){
  const items=loadItems();
  if(confirm('ยืนยันลบ?')){
    items[type].splice(index,1);
    saveItems(items); renderItems();
  }
}
</script>

</body>
</html>
